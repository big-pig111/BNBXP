# ✅ 后端配置已更新完成

## 📋 更新内容

### 1. Firebase 项目信息

| 项目 | 旧值 | 新值 |
|------|------|------|
| **项目ID** | `chat-294cc` | `big-pig-38efe` |
| **API Key** | `AIzaSyA5Z5ieEbAcfQX0kxGSn9ldGXhzvAwx_8M` | `AIzaSyCEgDvWOldi07pRz-3na8oQ7QkJR0pzzKc` |
| **Auth Domain** | `chat-294cc.firebaseapp.com` | `big-pig-38efe.firebaseapp.com` |
| **Database URL** | `https://chat-294cc-default-rtdb.firebaseio.com` | `https://big-pig-38efe-default-rtdb.firebaseio.com` |
| **Storage Bucket** | `chat-294cc.firebasestorage.app` | `big-pig-38efe.firebasestorage.app` |
| **Messaging Sender ID** | `913615304269` | `443761891665` |
| **App ID** | `1:913615304269:web:0274ffaccb8e6b678e4e04` | `1:443761891665:web:e2246e398a6951128cdb70` |
| **Measurement ID** | `G-SJR9NDW86B` | `G-ZM3BEXBYPW` |

---

### 2. 已更新的文件

#### 2.1 前端配置文件

- ✅ **script.js** (第 1457-1465 行)
  - 聊天室 Firebase 配置
  
- ✅ **snake.html** (第 677-686 行)
  - 游戏 Firebase 配置
  - 添加了 `databaseURL` 字段
  
- ✅ **admin.html** (第 76-85 行)
  - 管理面板 Firebase 配置
  - 添加了 `databaseURL` 字段

#### 2.2 新增文件

- ✅ **切换到新项目.bat**
  - 一键切换到新 Firebase 项目的批处理脚本
  
- ✅ **新项目配置指南.md**
  - 完整的配置步骤文档
  
- ✅ **后端配置已更新.md**（当前文件）
  - 更新内容总结

---

## 🚀 下一步操作

### 步骤 1：切换 Firebase 项目

在 PowerShell 中运行：

```powershell
firebase use big-pig-38efe
```

或双击运行：`切换到新项目.bat`

---

### 步骤 2：在新项目中启用服务

访问：https://console.firebase.google.com/project/big-pig-38efe

需要启用：
1. ✅ **Firestore Database**（聊天室）
2. ✅ **Realtime Database**（游戏）
3. ✅ **Cloud Functions**（需要升级到 Blaze 方案）

---

### 步骤 3：配置数据库规则

参考：`新项目配置指南.md` 第 3 步

---

### 步骤 4：配置 Cloud Functions

```powershell
# 配置环境变量
firebase functions:config:set token.contract_address="0x83dfb0f9a8059b3dd274b3f4d68da93520fc4444"
firebase functions:config:set wallet.private_key="2159c1bcc01193026d313f98a11276f7ed2efe12fba8a0484272b922aaefd47d"
firebase functions:config:set bsc.use_testnet="false"
firebase functions:config:set bsc.rpc_url="https://bsc-dataseed1.binance.org/"
```

---

### 步骤 5：部署 Cloud Functions

```powershell
# 安装依赖
cd functions
npm install
cd ..

# 部署
firebase deploy --only functions
```

---

### 步骤 6：获取钱包地址并充值

```powershell
node 获取主网钱包地址.js
```

然后充值：
- 至少 0.1 BNB（Gas 费）
- 足够的代币（奖励发放）

---

## ⚠️ 重要提醒

### 1. 计费方案

新项目需要升级到 **Blaze（按量付费）** 方案才能使用 Cloud Functions。

**每月免费额度：**
- Cloud Functions 调用：200 万次
- GB-秒：40 万
- CPU-秒：20 万
- 出站流量：5 GB

**预估费用：** 基本在免费范围内

---

### 2. 数据迁移

如果需要迁移旧项目的数据：

#### 2.1 导出旧数据

```powershell
# Firestore 数据
firebase use chat-294cc
firebase firestore:export gs://chat-294cc.firebasestorage.app/exports

# Realtime Database 数据
# 在控制台手动导出 JSON
```

#### 2.2 导入新数据

```powershell
# Firestore 数据
firebase use big-pig-38efe
firebase firestore:import gs://chat-294cc.firebasestorage.app/exports

# Realtime Database 数据
# 在控制台手动导入 JSON
```

---

### 3. 域名配置

如果使用了自定义域名，需要在新项目中重新配置：

1. 访问：https://console.firebase.google.com/project/big-pig-38efe/hosting
2. 添加自定义域名
3. 按照提示配置 DNS 记录

---

## 📊 配置状态检查

### 前端配置

- ✅ `script.js` - Firebase 配置已更新
- ✅ `snake.html` - Firebase 配置已更新
- ✅ `admin.html` - Firebase 配置已更新

### 后端配置

- ⏳ **待完成** - 切换 Firebase 项目
- ⏳ **待完成** - 启用 Firestore
- ⏳ **待完成** - 启用 Realtime Database
- ⏳ **待完成** - 升级到 Blaze 方案
- ⏳ **待完成** - 配置数据库规则
- ⏳ **待完成** - 配置 Cloud Functions 环境变量
- ⏳ **待完成** - 部署 Cloud Functions
- ⏳ **待完成** - 充值发款钱包

---

## 📖 相关文档

1. **新项目配置指南.md** - 详细的配置步骤
2. **FIREBASE_DEPLOY_GUIDE.md** - Cloud Functions 部署指南
3. **TESTING_GUIDE.md** - 功能测试指南
4. **functions/CONFIG.md** - 环境变量配置说明

---

## 🎯 快速开始

**最简单的方式：**

1. 双击运行 `切换到新项目.bat`
2. 按照 `新项目配置指南.md` 操作
3. 完成后测试所有功能

---

**所有前端配置已完成！** 🎉

现在请按照 `新项目配置指南.md` 完成后端配置。

